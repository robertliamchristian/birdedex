<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bird&eacute;dex</title>
    <style>
        #header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 140px;
            background-color: #A80824;
            color: white;
            text-align: center;
            padding: 0px;
            z-index: 1;
        }

        #name_header {
        	font-size: 36pt;
        	margin-bottom: 0px;
        	margin-top: 5px;
        }

        #subheader {
        	color: white;
        	margin-bottom: 10px;

        }

        #content {
            margin-top: 115px;  /* Adjusted to 90px */
            padding: 20px;
            overflow-y: auto;
            height: calc(100vh - 90px);  /* Adjusted to 90px */
            background-color: #D1D0CE;
            color: #5F5D59;
            width: 100%;
        }

        #main-container {
            max-width: 200px;
            max-height: 400px;
            margin: auto;
        }

        #spacer {
            height: 10px; 
        }

        body {
    		font-family: "Avenir Next", monospace;
        }

        ul.no-bullets {
            list-style-type: none; 
        }
        
        #suggestions {
            border: 1px solid #A80824;
            position: right;
            background-color: #A80824;
        }

        #suggestions div {
            padding: 5px;
            cursor: pointer;
        }

        #suggestions div:hover {
            background-color: #A80824;
        }
        

    </style>
</head>
<body>
    <div id="header">
        <div id="name_header"><b>Bird&eacute;dex</b></div>
        <div id="subheader">{{ sighted_count }}/{{ total_bird_count }} Total Logged</div>
    <form action="/" method="post">
        <input type="text" name="bird" id="bird-input" placeholder="Enter a bird name" oninput="fetchSuggestions()">
        <input type="submit" value="Submit">
        <div id="suggestions" style="display:none;"></div>
    </form>
    {% if message %}
    <p>{{ message }}</p>
    {% endif %}
</div>
<div id="content">
    {% for bird_type, sightings in grouped_sightings.items() %}
        <h3>{{ bird_type }}</h3>
        <ul class=no-bullets>
            {% for counter, sighting in sightings %}
                <li id="bird-{{ sighting.birdid }}">
                    {{ counter }}. 
                    {% if sighting.sighting_time %}
                        {{ sighting.bird }} - {{ sighting.sighting_time }}
                    {% else %}
                        ???
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endfor %}
</div>

{% if anchor_id %}
<script>
window.onload = function() {
    var element = document.getElementById("{{ anchor_id }}");
    if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
};
</script>
{% endif %}

<input type="text" name="bird" id="bird-input" placeholder="Enter a bird name" oninput="fetchSuggestions()">

<div id="suggestions" style="display:none;"></div>

<script>
function fetchSuggestions() {
    var input = document.getElementById('bird-input');
    var query = input.value;

    if (query.length < 2) {  // Adjust the length as needed
        document.getElementById('suggestions').style.display = 'none';
        return; // Don't fetch suggestions for very short queries
    }

    fetch('/suggest_birds?query=' + query)
        .then(response => response.json())
        .then(suggestions => {
            var suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = ''; // Clear previous suggestions
            suggestions.forEach(function(suggestion) {
                var div = document.createElement('div');
                div.innerHTML = suggestion;
                div.onclick = function() {
                    input.value = suggestion; // Fill input with selected suggestion
                    suggestionsDiv.style.display = 'none'; // Hide suggestions
                };
                suggestionsDiv.appendChild(div);
            });
            if (suggestions.length > 0) {
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        })
        .catch(error => console.error('Error fetching suggestions:', error));
}

window.onclick = function(event) {
    if (!event.target.matches('#bird-input')) {
        document.getElementById('suggestions').style.display = 'none';
    }
};
</script>



</body>
</html>
